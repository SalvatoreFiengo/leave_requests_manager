{% extends 'base.html'%}

{%block content%}
{%set _rew=userslist.rewind()%}
{%set counter=namespace(all=0,approved=0,rejected=0,to_be_approved=0)%}
{%set approved=0%}
{%set rejected=0%}
{%set to_be_approved=0%}
{%set all=0%}
{%for request in userslist%}
    
    {%if request.leave_request[-1].deleted == false%}
        {%set all=all+1%}
        {%set counter.all=all%}
        {%if request.leave_request[-1].approved == true%}
            {%set approved=approved+1%}
            {%set counter.approved=approved%}
        {%elif request.leave_request[-1].rejected == true%}
            {%set rejected=rejected+1%}
            {%set counter.rejected=rejected%}
        {%elif request.leave_request[-1].approved==false and request.leave_request[-1].rejected == false%}
            {%set to_be_approved=to_be_approved+1%}
            {%set counter.to_be_approved=to_be_approved%}
        {%endif%}

    {%endif%}
    
{%endfor%}
    
    
{%include 'breadcrumb.html' with context%}
<div class="row">
    <div class="col-xl-3 col-sm-6 mb-3">
            <form id="all_requests_form" action="{{url_for('leave_requests_datatable',status='all_requests')}}" method="POST">
                <div class="card text-white bg-info o-hidden h-100">
                    <div class="card-body">
                        <div class="card-body-icon">
                            <i class="fas fa-fw fa-user"></i>
                        </div>
                        <div class="mr-5">{{counter.all}} - All Requests</div>
                    </div>
                    <a id="all_requests" class="card-footer text-white clearfix small z-1" href="#">
                        <span class="float-left">View Details</span>
                        <span class="float-right">
                        <i class="fas fa-angle-right"></i>
                        </span>
                    </a>
                </div>
            </form>
        </div>
    <div class="col-xl-3 col-sm-6 mb-3">
        <form id="to_be_approved_form" action="{{url_for('leave_requests_datatable',status='to_be_approved')}}" method="POST">
            <div class="card text-white bg-warning o-hidden h-100">
            <div class="card-body">
                <div class="card-body-icon">
                    <i class="fas fa-fw fa-calendar-alt"></i>
                </div>
                <div class="mr-5"> {{counter.to_be_approved}} - New Approval Requests!</div>
            </div>
                <a id="to_be_approved" type="submit" class="card-footer text-white clearfix small z-1" href="#">
                    <span class="float-left">View Details</span>
                    <span class="float-right">
                    <i class="fas fa-angle-right"></i>
                    </span>
                </a>
            </div>
        </form>
    </div>

    <div class="col-xl-3 col-sm-6 mb-3">
        <form id="approved_requests_form" action="{{url_for('leave_requests_datatable',status='approved_requests')}}" method="POST">
            <div class="card text-white bg-success o-hidden h-100">
            <div class="card-body">
                <div class="card-body-icon">
                <i class="fas fa-fw fa-calendar-check"></i>
                </div>
                <div class="mr-5">{{counter.approved}} - Approved Requests</div>
            </div>
            <a id="approved_requests" class="card-footer text-white clearfix small z-1" href="#">
                <span class="float-left">View Details</span>
                <span class="float-right">
                <i class="fas fa-angle-right"></i>
                </span>
            </a>
            </div>
        </form>
    </div>
    <div class="col-xl-3 col-sm-6 mb-3">
        <div class="card text-white bg-danger o-hidden h-100">
        <div class="card-body">
            <div class="card-body-icon">
            <i class="fas fa-fw fa-calendar-times"></i>
            </div>
            <div class="mr-5"> {{counter.rejected}} Rejected Requests!</div>
        </div>
        <a class="card-footer text-white clearfix small z-1" href="#">
            <span class="float-left">View Details</span>
            <span class="float-right">
            <i class="fas fa-angle-right"></i>
            </span>
        </a>
        </div>
    </div>
</div>
{%include 'leaveRequestTable.html' with context%}
 

       


<script src="{{url_for('static',filename='vendor/jquery/jquery.min.js')}}"></script>
<script>
    $(document).ready(function(){
        $('#to_be_approved').click(function(event){
            event.preventDefault();
            $('#to_be_approved_form').submit();
            return false;
        })
        $('#approved_requests').click(function(event){
            event.preventDefault();
            $('#approved_requests_form').submit();
            return false;
        })
        $('#all_requests').click(function(event){
            event.preventDefault();
            $('#all_requests_form').submit();
            return false;
        })
    })
</script>    
{%endblock content%}
    
    
